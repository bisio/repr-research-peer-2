---
title: "Storms"
author: "Andrea Bisognin"
date: "09/17/2014"
output: html_document
---

# Data Processing



```{r load_data,cache=TRUE}
storms <- read.csv(bzfile("StormData.csv.bz2"))
```

We keep only data relevant to questions and we tidy it up:

```{r reduce,cache=TRUE}
storms <- subset(storms,T,c("EVTYPE","LONGITUDE","FATALITIES", "INJURIES", "PROPDMG", 
    "PROPDMGEXP", "CROPDMG", "CROPDMGEXP"))


```



```{r dependencies}
library(plyr)
library(xtable)
```


```{r preprocess}
health <- ddply(storms,.(EVTYPE),summarize,tot.fatalities=sum(FATALITIES),tot.injuries=sum(INJURIES))
health <- arrange(health, desc(tot.fatalities),desc(tot.injuries))
```


# Results
## Weather events most harmeful to human health (nationwide)

In the following table are reported the 10 most harmful events in USA with respect to population health using as variables total number of fatalities and injuries. 

```{r table1, results='asis'}
print(xtable(head(health,n=10),display=c("d","s","d","d")),type="html")
```

```{r geo_health}
storms.geo.sane <- subset(storms,LONGITUDE >= 5000 & LONGITUDE <= 13000)

longitude.as.str <- sprintf("%0.5d",storms.geo.sane$LONGITUDE)
longitude <- as.numeric(substr(longitude.as.str,1,3))


storms.geo.sane$longitude.bin <- cut(longitude,breaks=10)
health.geo <-  ddply(storms.geo.sane,.(longitude.bin,EVTYPE),summarize,tot.fatalities=sum(FATALITIES,na.rm=T),tot.injuries=sum(INJURIES,na.rm=T))
health.geo.dist <- ddply(health.geo,.(longitude.bin),function(df) { 
        df <- arrange(df,desc(tot.fatalities),desc(tot.injuries))
        df[1,] })
```

## Weather events most harmeful to human health (east-west axis distribution)
```{r table2,results='asis'}
print(xtable(health.geo.dist,display=c("d","s","s","d","d")),type="html")
```

